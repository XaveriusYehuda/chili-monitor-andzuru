(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const e of o)if(e.type==="childList")for(const a of e.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&c(a)}).observe(document,{childList:!0,subtree:!0});function r(o){const e={};return o.integrity&&(e.integrity=o.integrity),o.referrerPolicy&&(e.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?e.credentials="include":o.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function c(o){if(o.ep)return;o.ep=!0;const e=r(o);fetch(o.href,e)}})();const pt="SensorMonitorDB",ft=1,y="humidityUpdates",S="phUpdates";let p;function ht(){return new Promise((t,n)=>{const r=indexedDB.open(pt,ft);r.onerror=c=>{console.error("Error opening IndexedDB:",c.target.errorCode),n(c.target.errorCode)},r.onsuccess=c=>{p=c.target.result,console.log("IndexedDB opened successfully"),t(p)},r.onupgradeneeded=c=>{const o=c.target.result;o.objectStoreNames.contains(S)||(o.createObjectStore(S,{keyPath:"id",autoIncrement:!0}),console.log(`Object store '${S}' created.`)),o.objectStoreNames.contains(y)||(o.createObjectStore(y,{keyPath:"id",autoIncrement:!0}),console.log(`Object store '${y}' created.`))}})}function bt(t){if(!p){console.warn("IndexedDB not open. Cannot save pH data.");return}if(!t||typeof t!="object"){console.warn("Invalid pH data. Not saving to IndexedDB.");return}"id"in t&&delete t.id;const c=p.transaction([S],"readonly").objectStore(S).openCursor(null,"prev");c.onsuccess=o=>{const e=o.target.result;if(e&&e.value.phValue===t.phValue){console.warn("pH data is a duplicate of the immediately previous record. Not saving.");return}const i=p.transaction([S],"readwrite").objectStore(S).add(t);i.onsuccess=()=>{console.log("pH data successfully saved to IndexedDB.")},i.onerror=d=>{console.error("Error saving pH data to IndexedDB:",d.target.errorCode)}},c.onerror=o=>{console.error("Error checking for duplicate pH data in IndexedDB:",o.target.errorCode)}}function yt(t){if(!p){console.warn("IndexedDB not open. Cannot save humidity data.");return}if(!t||typeof t!="object"){console.warn("Invalid humidity data. Not saving to IndexedDB.");return}"id"in t&&delete t.id;const c=p.transaction([y],"readonly").objectStore(y).openCursor(null,"prev");c.onsuccess=o=>{const e=o.target.result;if(e&&e.value.humidityValue===t.humidityValue){console.warn("Humidity data is a duplicate of the immediately previous record. Not saving.");return}const i=p.transaction([y],"readwrite").objectStore(y).add(t);i.onsuccess=()=>{console.log("Humidity data successfully saved to IndexedDB.")},i.onerror=d=>{console.error("Error saving Humidity data to IndexedDB:",d.target.errorCode)}},c.onerror=o=>{console.error("Error checking for duplicate humidityValue in IndexedDB:",o.target.errorCode)}}function rt(t=8){return new Promise((n,r)=>{if(!p){console.warn("IndexedDB not open. Cannot get data."),n([]);return}const e=p.transaction([y],"readonly").objectStore(y).openCursor(null,"prev"),a=[];e.onsuccess=s=>{const i=s.target.result;i&&a.length<t?(a.push(i.value),i.continue()):n(a)},e.onerror=s=>{console.error("Error getting data from IndexedDB:",s.target.errorCode),r(s.target.errorCode)}})}function at(t=8){return new Promise((n,r)=>{if(!p){console.warn("IndexedDB not open. Cannot get data."),n([]);return}const e=p.transaction([S],"readonly").objectStore(S).openCursor(null,"prev"),a=[];e.onsuccess=s=>{const i=s.target.result;i&&a.length<t&&(a.push(i.value),i.continue())},e.onerror=s=>{console.error("Error getting data from IndexedDB:",s.target.errorCode),r(s.target.errorCode)}})}function St(t="ph_data.csv"){return new Promise((n,r)=>{if(!p){console.warn("IndexedDB not open. Cannot get data."),r("IndexedDB not open");return}const e=p.transaction([S],"readonly").objectStore(S).openCursor();let a=[],s=[],i=!0;e.onsuccess=d=>{const m=d.target.result;if(m){const u=m.value;i&&(s=Object.keys(u),a.push(s.join(",")),i=!1);const f=s.map(h=>{let l=u[h];return l===null||typeof l>"u"?"":typeof l=="string"&&(l.includes(",")||l.includes('"')||l.includes(`
`))?`"${l.replace(/"/g,'""')}"`:l}).join(",");a.push(f),m.continue()}else{console.log("semua data telah diiterasi");const u=a.join(`
`),f=new Blob([u],{type:"text/csv;charset=utf-8;"}),h=URL.createObjectURL(f),l=document.createElement("a");l.href=h,l.download=t,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(h),console.log(`Data exported to ${t}`),n()}},e.onerror=d=>{console.error("Error download data from IndexedDB:",d.target.errorCode),r(d.target.errorCode)}})}function wt(t="humidity_data.csv"){return new Promise((n,r)=>{if(!p){console.warn("IndexedDB not open. Cannot get data."),r("IndexedDB not open");return}const e=p.transaction([y],"readonly").objectStore(y).openCursor();let a=[],s=[],i=!0;e.onsuccess=d=>{const m=d.target.result;if(m){const u=m.value;i&&(s=Object.keys(u),a.push(s.join(",")),i=!1);const f=s.map(h=>{let l=u[h];return l===null||typeof l>"u"?"":typeof l=="string"&&(l.includes(",")||l.includes('"')||l.includes(`
`))?`"${l.replace(/"/g,'""')}"`:l}).join(",");a.push(f),m.continue()}else{console.log("semua data telah diiterasi");const u=a.join(`
`),f=new Blob([u],{type:"text/csv;charset=utf-8;"}),h=URL.createObjectURL(f),l=document.createElement("a");l.href=h,l.download=t,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(h),console.log(`Data exported to ${t}`),n()}},e.onerror=d=>{console.error("Error download data from IndexedDB:",d.target.errorCode),r(d.target.errorCode)}})}const vt="ae2f0qpfo130e-ats.iot.ap-southeast-1.amazonaws.com",it="ap-southeast-1",kt="ap-southeast-1:66f016b1-04c1-4719-8774-bf55d732f161";AWS.config.region=it;AWS.config.credentials=new AWS.CognitoIdentityCredentials({IdentityPoolId:kt});let A;const Ct=async()=>{try{await new Promise((n,r)=>{AWS.config.credentials.get(c=>{c?r(c):n()})}),console.log("✅ Cognito Credentials loaded.");const t=Dt.getSignedUrl(vt,it,AWS.config.credentials.accessKeyId,AWS.config.credentials.secretAccessKey,AWS.config.credentials.sessionToken);A=mqtt.connect(t,{reconnectPeriod:5e3,clientId:"webclient_"+Math.floor(Math.random()*1e4),protocol:"wss",clean:!0}),A.on("connect",()=>{console.log("✅ MQTT connected")}),A.on("error",n=>{console.error("❌ MQTT Error:",n)})}catch(t){console.error("❌ Gagal load Cognito credentials:",t)}};window.nyalakanPompa=()=>{if(!A||!A.connected){console.error("🚫 MQTT belum terkoneksi. Tidak bisa publish.");return}const t=moment().format("YYYY-MM-DD HH:mm:ss"),n=document.getElementById("flushButton");n.classList.add("opacity-80"),n.disabled=!0,n.textContent="Sending ...",setTimeout(()=>{n.textContent="Flushing ..."},2e3),setTimeout(()=>{n.classList.remove("opacity-80"),n.disabled=!1,n.textContent="Flush"},3e4);const r=JSON.stringify({action:"nyala"});A.publish("device/pompa",r,{qos:1},c=>{c?console.error("🚫 Publish error:",c):console.log("📤 Pompa nyala command dikirim pada",t)})};const Dt={getSignedUrl:function(t,n,r,c,o){const e=new Date,a=e.toISOString().slice(0,10).replace(/-/g,""),s=e.toISOString().replace(/[:-]|\.\d{3}/g,""),i="iotdevicegateway",d="AWS4-HMAC-SHA256",m="GET",u="/mqtt",f=a+"/"+n+"/"+i+"/aws4_request",h="X-Amz-Algorithm="+d+"&X-Amz-Credential="+encodeURIComponent(r+"/"+f)+"&X-Amz-Date="+s+"&X-Amz-SignedHeaders=host",l="host:"+t+`
`,M=AWS.util.crypto.sha256("","hex"),j=m+`
`+u+`
`+h+`
`+l+`
host
`+M,C=d+`
`+s+`
`+f+`
`+AWS.util.crypto.sha256(j,"hex"),D=AWS.util.crypto.hmac(AWS.util.crypto.hmac(AWS.util.crypto.hmac(AWS.util.crypto.hmac("AWS4"+c,a,"buffer"),n,"buffer"),i,"buffer"),"aws4_request","buffer"),$=AWS.util.crypto.hmac(D,C,"hex");let F="wss://"+t+u+"?"+h+"&X-Amz-Signature="+$;return o&&(F+="&X-Amz-Security-Token="+encodeURIComponent(o)),F}};let w;const ct=()=>{if(w&&w.readyState!==WebSocket.CLOSED&&w.readyState!==WebSocket.CLOSING){console.log("WebSocket sudah aktif. Tidak membuat koneksi baru.");return}const t="wss://chili-monitor-data.andzuru.space";w=new WebSocket(t),w.onopen=async()=>{console.log("✅ WebSocket connected to",t)},w.onmessage=n=>{try{const r=JSON.parse(n.data);console.log("📨 Data diterima:",r);const{topic:c,data:o,chartData:e,timestamp:a}=r,{ph:s,humidity:i}=e||{};let d=null;if(s&&Array.isArray(s.timestamps)&&s.timestamps.length>0){let g=s.timestamps[s.timestamps.length-1];typeof g=="string"&&g?d=new Date(g).toISOString():typeof g=="number"&&!isNaN(g)&&(g<1e10&&(g*=1e3),d=new Date(g).toISOString())}let m=null;if(i&&Array.isArray(i.timestamps)&&i.timestamps.length>0){let g=i.timestamps[i.timestamps.length-1];typeof g=="string"&&g?m=new Date(g).toISOString():typeof g=="number"&&!isNaN(g)&&(g<1e10&&(g*=1e3),m=new Date(g).toISOString())}const u=Date.now(),f=isNaN(Number(a))?0:u-Number(a),h=isNaN(Number(a))?null:new Date(Number(a)+7*60*60*1e3).toISOString(),l=new Date(u+7*60*60*1e3).toISOString();let M,j;o&&(o.Kelembapan!==void 0&&o.Kelembapan!==null&&!isNaN(parseFloat(o.Kelembapan))?(window.latestRecordHumidity={timestampCloudReceived:h,timestampBrowserReceived:l,latency:parseFloat(f),humidityValue:parseFloat(o.Kelembapan),humidityDataReceivedAt:m},M=window.latestRecordHumidity):console.log("Kelembapan tidak ada pembaharuan data"),o.Ph!==void 0&&o.Ph!==null&&!isNaN(parseFloat(o.Ph))?(window.latestRecordPh={timestampCloudReceived:h,timestampBrowserReceived:l,latency:parseFloat(f),phValue:parseFloat(o.Ph),phDataReceivedAt:d},j=window.latestRecordPh):console.log("PH tidak ada pembaharuan data"));const C=parseFloat((o==null?void 0:o.Ph)??"NaN"),D=parseFloat((o==null?void 0:o.Kelembapan)??"NaN"),$=isNaN(C)?"N/A":C.toFixed(1),F=isNaN(D)?"N/A":D.toFixed(1),z=document.getElementById("phValue"),J=document.getElementById("humidityValue"),G=document.getElementById("ground-good-status"),Q=document.getElementById("ground-poor-status");if(!isNaN(C)&&!isNaN(D)&&(C>9.5||C<5||D>90||D<10)?(G.classList.add("hidden"),Q.classList.remove("hidden")):(Q.classList.add("hidden"),G.classList.remove("hidden")),z&&(z.textContent=$),J&&(J.textContent=F),e){if(s&&Array.isArray(s.timestamps)&&Array.isArray(s.values)){const g=s.timestamps.map(Number),W=s.values.map(Number);navigator.onLine?(Lt(g,W),bt(j)):at(1).then(N=>{N&&N.length>0&&setTimeout(At,200)})}if(i&&Array.isArray(i.timestamps)&&Array.isArray(i.values)){const g=i.timestamps.map(Number),W=i.values.map(Number);navigator.onLine?(Mt(g,W),yt(M)):rt(1).then(N=>{N&&N.length>0&&setTimeout(Pt,200)})}}}catch(r){console.error("❌ Error parsing WebSocket message:",r)}},w.onerror=n=>{console.error("⚠️ WebSocket error:",n)},w.onclose=n=>{console.warn(`⚠️ WebSocket disconnected. Code: ${n.code}, Reason: ${n.reason}`),setTimeout(()=>{console.log("🔁 Mencoba reconnect WebSocket..."),ct()},5e3)}},X="BEr7RhsHyH-U39qwfNHjCgsxD3_cBFL17xttbkvTWYbavxeJoED-IKkSf1Ui4CUYiIdGsNeknYBqeEjVuIFQgFc";function Z(t){const n="=".repeat((4-t.length%4)%4),r=(t+n).replace(/\-/g,"+").replace(/_/g,"/"),c=window.atob(r),o=new Uint8Array(c.length);for(let e=0;e<c.length;++e)o[e]=c.charCodeAt(e);return o}async function tt(t,n){if(!n)throw console.error("No auth token found"),new Error("Authentication token is missing.");const r="https://chili-monitor-data.andzuru.space/api/save-subscription";console.log("Preparing subscription data for backend...");const c=t.getKey("p256dh"),o=t.getKey("auth");if(!c||!o)throw console.error("Subscription keys are missing"),new Error("Subscription keys are missing");const e={endpoint:t.endpoint,keys:{p256dh:btoa(String.fromCharCode(...new Uint8Array(c))),auth:btoa(String.fromCharCode(...new Uint8Array(o)))}};console.log("Sending subscription to backend:",e);try{const a=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(e)}),s=await a.json();if(!a.ok)throw console.error("Backend subscription error:",s),new Error(s.message||"Failed to send subscription to backend");return console.log("Backend subscription successful:",s),s}catch(a){throw console.error("Subscription error:",a),a}}async function et(t,n){if(!n)throw console.error("No auth token found"),new Error("Authentication token is missing.");const r="https://chili-monitor-data.andzuru.space/api/delete-subscription",c={endpoint:t};try{const o=await fetch(r,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(c)}),e=await o.json();if(!o.ok)throw new Error(e.message||"Failed to send unsubscription to backend");return console.log("Unsubscription sent to backend successfully:",e),e}catch(o){throw console.error("Error sending unsubscription to backend:",o),o}}async function V(){if(!("serviceWorker"in navigator)||!("PushManager"in window))return{supported:!1,subscribed:!1,error:"Push notification not supported"};try{const n=await(await navigator.serviceWorker.ready).pushManager.getSubscription();return{supported:!0,subscribed:!!n,subscriptionObject:n}}catch{return{supported:!0,subscribed:!1,error:"Failed to check subscription status."}}}function x(t){const n=document.getElementById("subscribeBtn"),r=document.getElementById("subscribeBtnMobile");n&&r&&(t?(n.textContent="Unsubscribe",n.classList.remove("text-primary","hover:text-tersier"),n.classList.add("bg-primary","px-6","text-white","rounded-full","transition-colors","hover:text-primary","hover:bg-white"),r.textContent="Unsubscribe",r.classList.remove("group-hover:text-tersier"),r.classList.add("bg-primary","px-6","text-white","rounded-full","transition-colors","hover:text-primary","hover:bg-white")):(n.textContent="Subscribe",n.classList.remove("bg-primary","px-6","text-white","rounded-full","hover:bg-white","hover:text-primary"),n.classList.add("text-primary","hover:text-tersier"),r.textContent="Subscribe",r.classList.remove("bg-primary","px-6","text-white","rounded-full","hover:bg-white","hover:text-primary"),r.classList.add("group-hover:text-tersier")))}async function It(){if(!("serviceWorker"in navigator)||!("PushManager"in window)){console.warn("Push notification tidak didukung.");return}try{const t=await navigator.serviceWorker.register("/sw.js");if(console.log("Service Worker terdaftar:",t),await Notification.requestPermission()==="denied"){console.warn("Izin notifikasi tidak diberikan"),x(!1);return}const r=await V();x(r.subscribed)}catch(t){console.error("Gagal setup push notification:",t)}}function Bt(t=8){return Math.random().toString(36).substring(2,2+t)}const P=document.getElementById("modal-notif-container"),H=document.getElementById("notif-modal-alert"),ot=document.getElementById("modal-main-notif"),xt=document.getElementById("title-notif-modal"),nt=document.getElementById("content-notif-modal"),st=document.getElementById("close-notif");function b(t,n){if(!P||!H||!ot||!nt||!st){console.error("Modal elements not found in the DOM");return}nt.textContent=n,xt.textContent=t,P.classList.remove("hidden"),H.classList.remove("hidden"),st.onclick=()=>{P.classList.add("hidden"),H.classList.add("hidden")},window.onclick=r=>{!ot.contains(r.target)&&r.target===P&&(P.classList.add("hidden"),H.classList.add("hidden"))}}async function dt(t=0){if(t>=5)return console.error("Failed to auto-register after multiple attempts due to duplicate username/email."),b("Registration Failed","Failed to auto-register after multiple attempts due to duplicate username/email."),!1;const r=Bt(6),c=`user${r}`,o=`user${r}@example.com`,e="password123";try{console.log(`Attempting to register with: Username=${c}, Email=${o}`);const a=await fetch("https://chili-monitor-data.andzuru.space/api/register-auto-login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:c,email:o,password:e})}),s=await a.json();if(a.ok&&s.success)return console.log("Registration successful, token received:",s.token),localStorage.setItem("userToken",s.token),localStorage.setItem("userToken_createdAt",Date.now()),b("Registration Successful","Registration successful! You have automatically logged in."),!0;if(a.status===409)return console.warn("Username or email already exists. Retrying with new random values."),dt(t+1);{console.error("Registration failed:",s.message||"Unknown error",s);const i="Registration Failed",d=`Registration failed: ${s.message||"An error occurred during registration."}`;return b(i,d),!1}}catch(a){return console.error("Error during registration:",a),b("Registration Failed","An error occurred during registration."),!1}}function Et(t){if(!t)return!1;try{const n=t.split(".");if(n.length!==3)return!1;const r=JSON.parse(atob(n[1]));if(r.exp){const c=Math.floor(Date.now()/1e3);if(r.exp<c)return console.log("Token expired locally."),!1}return!0}catch(n){return console.error("Error decoding or validating token locally:",n),!1}}document.addEventListener("DOMContentLoaded",async()=>{ct(),Ct(),ht().then(()=>{}).catch(e=>console.error("Failed to open IndexedDB:",e));let t=localStorage.getItem("userToken"),n=localStorage.getItem("userToken_createdAt");const r=24*60*60*1e3;if(t&&Et(t)&&Date.now()-n<r)console.log("Valid user token found in localStorage:",t);else if(console.log("No valid user token found or token expired/too old. Attempting to auto-register and login."),localStorage.removeItem("userToken"),localStorage.removeItem("userToken_createdAt"),await dt())t=localStorage.getItem("userToken"),console.log("Auto-registration and login successful. New Token:",t);else{console.error("Auto-registration and login failed. User cannot proceed without a token."),b("Registration Failed","Failed to obtain a user session. Certain functions may not work.");return}await It();const c=document.getElementById("subscribeBtn"),o=document.getElementById("subscribeBtnMobile");c&&c.addEventListener("click",async()=>{const e=localStorage.getItem("userToken");if(!e){b("Subscription Failed","User session not found. Please refresh the page to get a new session.");return}const a=await V();if(a.subscribed)try{await et(a.subscriptionObject.endpoint,e),await a.subscriptionObject.unsubscribe(),console.log("Successfully unsubscribed!"),x(!1),b("Successfully Unsubscribed","You have successfully unsubscribed from push notifications.")}catch(s){console.error("Error unsubscribing:",s),b("Unsubscription Failed","Failed to unsubscribe. Please try again.")}else try{const s=await navigator.serviceWorker.ready,i=Z(X),d=await s.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:i});await tt(d,e),console.log("Successfully subscribed!"),x(!0),b("Successful Subscription","You have successfully subscribed to push notifications!")}catch(s){console.error("Error subscribing:",s),b("Subscription Failed","Failed to subscribe. Please ensure notifications are enabled and try again.")}}),o&&o.addEventListener("click",async()=>{const e=localStorage.getItem("userToken");if(!e){b("Unsubscription Failed","User session not found. Please refresh the page to get a new session.");return}const a=await V();if(a.subscribed)try{await et(a.subscriptionObject.endpoint,e),await a.subscriptionObject.unsubscribe(),console.log("Successfully unsubscribed (Mobile)!"),x(!1),b("Unsubscription Failed","You have successfully unsubscribed from push notifications.")}catch(s){console.error("Error unsubscribing (Mobile):",s),b("Unsubscription Failed","Failed to unsubscribe. Please try again.")}else try{const s=await navigator.serviceWorker.ready,i=Z(X),d=await s.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:i});await tt(d,e),console.log("Successfully subscribed (Mobile)!"),x(!0),b("Successfully subscribed (Mobile)!","You have successfully subscribed to push notifications!")}catch(s){console.error("Error subscribing (Mobile):",s),b("Successfully subscribed (Mobile)!","Failed to subscribe. Please ensure notifications are enabled and try again.")}})});async function At(){const t=await at();if(!t||t.length===0){v.data.datasets[0].data=[],v.data.labels=[],v.update();return}const n=t.slice().reverse(),r=n.map(o=>{const e=new Date(o.phDataReceivedAt),a=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0"),d=String(e.getHours()).padStart(2,"0"),m=String(e.getMinutes()).padStart(2,"0"),u=String(e.getSeconds()).padStart(2,"0");return`${a}-${s}-${i} ${d}:${m}:${u}`}),c=n.map(o=>o.phValue);v.data.datasets[0].data=c,v.data.labels=r,v.update()}function Lt(t,n){function r(o){const e=new Date(o),a=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0"),d=String(e.getHours()).padStart(2,"0"),m=String(e.getMinutes()).padStart(2,"0"),u=String(e.getSeconds()).padStart(2,"0");return`${a}-${s}-${i} ${d}:${m}:${u}`}const c=t.map(o=>r(o));v.data.datasets[0].data=n,v.data.labels=c,v.update()}const Tt={labels:[],datasets:[{label:"Soil pH",data:[],borderColor:"rgba(75, 192, 192, 1)",backgroundColor:"rgba(75, 192, 192, 0.2)",borderWidth:2}]},Nt={type:"line",data:Tt,options:{scales:{y:{beginAtZero:!1}}}},v=new Chart(document.getElementById("myChart1"),Nt);async function Pt(){const t=await rt();if(!t||t.length===0){k.data.datasets[0].data=[],k.data.labels=[],k.update();return}const n=t.slice().reverse(),r=n.map(o=>{const e=new Date(o.humidityDataReceivedAt),a=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0"),d=String(e.getHours()).padStart(2,"0"),m=String(e.getMinutes()).padStart(2,"0"),u=String(e.getSeconds()).padStart(2,"0");return`${a}-${s}-${i} ${d}:${m}:${u}`}),c=n.map(o=>o.humidityValue);k.data.datasets[0].data=c,k.data.labels=r,k.update()}function Mt(t,n){function r(o){const e=new Date(o),a=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0"),d=String(e.getHours()).padStart(2,"0"),m=String(e.getMinutes()).padStart(2,"0"),u=String(e.getSeconds()).padStart(2,"0");return`${a}-${s}-${i} ${d}:${m}:${u}`}const c=t.map(o=>r(o));console.log(c),k.data.datasets[0].data=n,k.data.labels=c,k.update()}const jt={labels:[],datasets:[{label:"Soil Moisture",data:[],borderColor:"rgba(54, 162, 235, 1)",backgroundColor:"rgba(54, 162, 235, 0.2)",borderWidth:2}]},Ft={type:"line",data:jt,options:{scales:{y:{beginAtZero:!1}}}},k=new Chart(document.getElementById("myChart"),Ft),R=document.querySelector("#hamburger"),q=document.querySelector("#nav-menu");R.addEventListener("click",function(){R.classList.toggle("hamburger-active"),q.classList.toggle("hidden")});window.addEventListener("click",function(t){t.target!=R&&t.target!=q&&(R.classList.remove("hamburger-active"),q.classList.add("hidden"))});const O=document.getElementById("modal-container-1"),U=document.getElementById("modal-container-2"),L=document.getElementById("modal-confirm-download-container"),T=document.getElementById("modal-confirm-download-alert"),Ht=document.getElementById("modal-main"),Rt=document.getElementById("modal-main-download"),lt=document.getElementById("info-button"),ut=document.getElementById("close-modal"),I=document.getElementById("download-data"),K=document.getElementById("cancel-download"),_=document.getElementById("get-ph-data-modal"),Y=document.getElementById("get-humidity-data-modal"),E=document.getElementById("content-download-modal"),mt=document.getElementById("title-download-modal");let B=null;lt.addEventListener("click",()=>{O.classList.remove("hidden"),U.classList.remove("hidden")});_.addEventListener("click",()=>{L.classList.remove("hidden"),T.classList.remove("hidden"),B="ph",mt.textContent="Download PH Data",E.textContent="Do you want to download the pH data?"});Y.addEventListener("click",()=>{L.classList.remove("hidden"),T.classList.remove("hidden"),B="humidity",mt.textContent="Download Humidity Data",E.textContent="Do you want to download the humidity data?"});I.addEventListener("click",()=>{B==="ph"?(I.disabled=!0,E.textContent="Mengunduh data pH...",setTimeout(async()=>{await St()},4e3),setTimeout(()=>{I.disabled=!1,E.textContent="Data pH berhasil diunduh."},1500)):B==="humidity"&&(I.disabled=!0,E.textContent="Mengunduh data kelembapan...",setTimeout(async()=>{await wt()},4e3),setTimeout(()=>{I.disabled=!1,E.textContent="Data humidity berhasil diunduh."},1500)),setTimeout(()=>{L.classList.add("hidden"),T.classList.add("hidden"),B=null},5e3)});K.addEventListener("click",()=>{L.classList.add("hidden"),T.classList.add("hidden"),B=null});ut.addEventListener("click",()=>{O.classList.add("hidden"),U.classList.add("hidden")});window.addEventListener("click",function(t){!L.classList.contains("hidden")&&!T.classList.contains("hidden")?!Rt.contains(t.target)&&t.target!==I&&t.target!==K&&t.target!==_&&t.target!==Y&&(L.classList.add("hidden"),T.classList.add("hidden"),B=null):!O.classList.contains("hidden")&&!U.classList.contains("hidden")&&!Ht.contains(t.target)&&t.target!==I&&t.target!==lt&&t.target!==ut&&t.target!==K&&t.target!==_&&t.target!==Y&&(O.classList.add("hidden"),U.classList.add("hidden"))});flushButton.addEventListener("click",()=>{nyalakanPompa();const t={action:"pumpIsActive"};w.readyState===WebSocket.OPEN&&w.send(JSON.stringify(t))});function gt(){const t=moment(),n=t.hour(),r=t.minute(),c=t.second(),o=t.format("HH : mm : ss");document.getElementById("clock").textContent=o;let e;n<7||n===7&&r===0&&c===0?e=moment().hour(7).minute(0).second(0):e=moment().add(1,"days").hour(7).minute(0).second(0),n===7&&r===0&&c===0&&nyalakanPompa();const a=moment.duration(e.diff(t)),s=String(a.hours()).padStart(2,"0"),i=String(a.minutes()).padStart(2,"0"),d=String(a.seconds()).padStart(2,"0"),m=`${s}`,u=`${i}`,f=`${d}`;document.getElementById("countdownHour").textContent=m,document.getElementById("countdownMinute").textContent=u,document.getElementById("countdownSecond").textContent=f}setInterval(gt,1e3);gt();
