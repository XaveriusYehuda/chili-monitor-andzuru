(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function s(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(e){if(e.ep)return;e.ep=!0;const o=s(e);fetch(e.href,o)}})();const dt="SensorMonitorDB",lt=1,y="humidityUpdates",S="phUpdates";let b;function ut(){return new Promise((t,n)=>{const s=indexedDB.open(dt,lt);s.onerror=a=>{console.error("Error opening IndexedDB:",a.target.errorCode),n(a.target.errorCode)},s.onsuccess=a=>{b=a.target.result,console.log("IndexedDB opened successfully"),t(b)},s.onupgradeneeded=a=>{const e=a.target.result;e.objectStoreNames.contains(S)||(e.createObjectStore(S,{keyPath:"id",autoIncrement:!0}),console.log(`Object store '${S}' created.`)),e.objectStoreNames.contains(y)||(e.createObjectStore(y,{keyPath:"id",autoIncrement:!0}),console.log(`Object store '${y}' created.`))}})}function mt(t){if(!b){console.warn("IndexedDB not open. Cannot save pH data.");return}if(!t||typeof t!="object"){console.warn("Invalid pH data. Not saving to IndexedDB.");return}"id"in t&&delete t.id;const a=b.transaction([S],"readonly").objectStore(S).openCursor(null,"prev");a.onsuccess=e=>{const o=e.target.result;if(o&&o.value.phValue===t.phValue){console.warn("pH data is a duplicate of the immediately previous record. Not saving.");return}const c=b.transaction([S],"readwrite").objectStore(S).add(t);c.onsuccess=()=>{console.log("pH data successfully saved to IndexedDB.")},c.onerror=d=>{console.error("Error saving pH data to IndexedDB:",d.target.errorCode)}},a.onerror=e=>{console.error("Error checking for duplicate pH data in IndexedDB:",e.target.errorCode)}}function gt(t){if(!b){console.warn("IndexedDB not open. Cannot save humidity data.");return}if(!t||typeof t!="object"){console.warn("Invalid humidity data. Not saving to IndexedDB.");return}"id"in t&&delete t.id;const a=b.transaction([y],"readonly").objectStore(y).openCursor(null,"prev");a.onsuccess=e=>{const o=e.target.result;if(o&&o.value.humidityValue===t.humidityValue){console.warn("Humidity data is a duplicate of the immediately previous record. Not saving.");return}const c=b.transaction([y],"readwrite").objectStore(y).add(t);c.onsuccess=()=>{console.log("Humidity data successfully saved to IndexedDB.")},c.onerror=d=>{console.error("Error saving Humidity data to IndexedDB:",d.target.errorCode)}},a.onerror=e=>{console.error("Error checking for duplicate humidityValue in IndexedDB:",e.target.errorCode)}}function tt(t=8){return new Promise((n,s)=>{if(!b){console.warn("IndexedDB not open. Cannot get data."),n([]);return}const o=b.transaction([y],"readonly").objectStore(y).openCursor(null,"prev"),i=[];o.onsuccess=r=>{const c=r.target.result;c&&i.length<t?(i.push(c.value),c.continue()):n(i)},o.onerror=r=>{console.error("Error getting data from IndexedDB:",r.target.errorCode),s(r.target.errorCode)}})}function et(t=8){return new Promise((n,s)=>{if(!b){console.warn("IndexedDB not open. Cannot get data."),n([]);return}const o=b.transaction([S],"readonly").objectStore(S).openCursor(null,"prev"),i=[];o.onsuccess=r=>{const c=r.target.result;c&&i.length<t&&(i.push(c.value),c.continue())},o.onerror=r=>{console.error("Error getting data from IndexedDB:",r.target.errorCode),s(r.target.errorCode)}})}function pt(t="ph_data.csv"){return new Promise((n,s)=>{if(!b){console.warn("IndexedDB not open. Cannot get data."),s("IndexedDB not open");return}const o=b.transaction([S],"readonly").objectStore(S).openCursor();let i=[],r=[],c=!0;o.onsuccess=d=>{const l=d.target.result;if(l){const m=l.value;c&&(r=Object.keys(m),i.push(r.join(",")),c=!1);const g=r.map(f=>{let u=m[f];return u===null||typeof u>"u"?"":typeof u=="string"&&(u.includes(",")||u.includes('"')||u.includes(`
`))?`"${u.replace(/"/g,'""')}"`:u}).join(",");i.push(g),l.continue()}else{console.log("semua data telah diiterasi");const m=i.join(`
`),g=new Blob([m],{type:"text/csv;charset=utf-8;"}),f=URL.createObjectURL(g),u=document.createElement("a");u.href=f,u.download=t,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(f),console.log(`Data exported to ${t}`),n()}},o.onerror=d=>{console.error("Error download data from IndexedDB:",d.target.errorCode),s(d.target.errorCode)}})}function ft(t="humidity_data.csv"){return new Promise((n,s)=>{if(!b){console.warn("IndexedDB not open. Cannot get data."),s("IndexedDB not open");return}const o=b.transaction([y],"readonly").objectStore(y).openCursor();let i=[],r=[],c=!0;o.onsuccess=d=>{const l=d.target.result;if(l){const m=l.value;c&&(r=Object.keys(m),i.push(r.join(",")),c=!1);const g=r.map(f=>{let u=m[f];return u===null||typeof u>"u"?"":typeof u=="string"&&(u.includes(",")||u.includes('"')||u.includes(`
`))?`"${u.replace(/"/g,'""')}"`:u}).join(",");i.push(g),l.continue()}else{console.log("semua data telah diiterasi");const m=i.join(`
`),g=new Blob([m],{type:"text/csv;charset=utf-8;"}),f=URL.createObjectURL(g),u=document.createElement("a");u.href=f,u.download=t,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(f),console.log(`Data exported to ${t}`),n()}},o.onerror=d=>{console.error("Error download data from IndexedDB:",d.target.errorCode),s(d.target.errorCode)}})}const ht="ae2f0qpfo130e-ats.iot.ap-southeast-1.amazonaws.com",ot="ap-southeast-1",bt="ap-southeast-1:66f016b1-04c1-4719-8774-bf55d732f161";AWS.config.region=ot;AWS.config.credentials=new AWS.CognitoIdentityCredentials({IdentityPoolId:bt});let A;const yt=async()=>{try{await new Promise((n,s)=>{AWS.config.credentials.get(a=>{a?s(a):n()})}),console.log("‚úÖ Cognito Credentials loaded.");const t=St.getSignedUrl(ht,ot,AWS.config.credentials.accessKeyId,AWS.config.credentials.secretAccessKey,AWS.config.credentials.sessionToken);A=mqtt.connect(t,{reconnectPeriod:5e3,clientId:"webclient_"+Math.floor(Math.random()*1e4),protocol:"wss",clean:!0}),A.on("connect",()=>{console.log("‚úÖ MQTT connected")}),A.on("error",n=>{console.error("‚ùå MQTT Error:",n)})}catch(t){console.error("‚ùå Gagal load Cognito credentials:",t)}};window.nyalakanPompa=()=>{if(!A||!A.connected){console.error("üö´ MQTT belum terkoneksi. Tidak bisa publish.");return}const t=moment().format("YYYY-MM-DD HH:mm:ss"),n=document.getElementById("flushButton");n.classList.add("opacity-80"),n.disabled=!0,n.textContent="Sending ...",setTimeout(()=>{n.textContent="Flushing ..."},2e3),setTimeout(()=>{n.classList.remove("opacity-80"),n.disabled=!1,n.textContent="Flush"},3e4);const s=JSON.stringify({action:"nyala"});A.publish("device/pompa",s,{qos:1},a=>{a?console.error("üö´ Publish error:",a):console.log("üì§ Pompa nyala command dikirim pada",t)})};const St={getSignedUrl:function(t,n,s,a,e){const o=new Date,i=o.toISOString().slice(0,10).replace(/-/g,""),r=o.toISOString().replace(/[:-]|\.\d{3}/g,""),c="iotdevicegateway",d="AWS4-HMAC-SHA256",l="GET",m="/mqtt",g=i+"/"+n+"/"+c+"/aws4_request",f="X-Amz-Algorithm="+d+"&X-Amz-Credential="+encodeURIComponent(s+"/"+g)+"&X-Amz-Date="+r+"&X-Amz-SignedHeaders=host",u="host:"+t+`
`,P=AWS.util.crypto.sha256("","hex"),M=l+`
`+m+`
`+f+`
`+u+`
host
`+P,C=d+`
`+r+`
`+g+`
`+AWS.util.crypto.sha256(M,"hex"),I=AWS.util.crypto.hmac(AWS.util.crypto.hmac(AWS.util.crypto.hmac(AWS.util.crypto.hmac("AWS4"+a,i,"buffer"),n,"buffer"),c,"buffer"),"aws4_request","buffer"),O=AWS.util.crypto.hmac(I,C,"hex");let j="wss://"+t+m+"?"+f+"&X-Amz-Signature="+O;return e&&(j+="&X-Amz-Security-Token="+encodeURIComponent(e)),j}};let w;const nt=()=>{if(w&&w.readyState!==WebSocket.CLOSED&&w.readyState!==WebSocket.CLOSING){console.log("WebSocket sudah aktif. Tidak membuat koneksi baru.");return}const t="wss://chili-monitor-data.andzuru.space";w=new WebSocket(t),w.onopen=async()=>{console.log("‚úÖ WebSocket connected to",t)},w.onmessage=n=>{try{const s=JSON.parse(n.data);console.log("üì® Data diterima:",s);const{topic:a,data:e,chartData:o,timestamp:i}=s,{ph:r,humidity:c}=o||{};let d=null;if(r&&Array.isArray(r.timestamps)&&r.timestamps.length>0){let p=r.timestamps[r.timestamps.length-1];typeof p=="string"&&p?d=new Date(p).toISOString():typeof p=="number"&&!isNaN(p)&&(p<1e10&&(p*=1e3),d=new Date(p).toISOString())}let l=null;if(c&&Array.isArray(c.timestamps)&&c.timestamps.length>0){let p=c.timestamps[c.timestamps.length-1];typeof p=="string"&&p?l=new Date(p).toISOString():typeof p=="number"&&!isNaN(p)&&(p<1e10&&(p*=1e3),l=new Date(p).toISOString())}const m=Date.now(),g=isNaN(Number(i))?0:m-Number(i),f=isNaN(Number(i))?null:new Date(Number(i)+7*60*60*1e3).toISOString(),u=new Date(m+7*60*60*1e3).toISOString();let P,M;e&&(e.Kelembapan!==void 0&&e.Kelembapan!==null&&!isNaN(parseFloat(e.Kelembapan))?(window.latestRecordHumidity={timestampCloudReceived:f,timestampBrowserReceived:u,latency:parseFloat(g),humidityValue:parseFloat(e.Kelembapan),humidityDataReceivedAt:l},P=window.latestRecordHumidity):console.log("Kelembapan tidak ada pembaharuan data"),e.Ph!==void 0&&e.Ph!==null&&!isNaN(parseFloat(e.Ph))?(window.latestRecordPh={timestampCloudReceived:f,timestampBrowserReceived:u,latency:parseFloat(g),phValue:parseFloat(e.Ph),phDataReceivedAt:d},M=window.latestRecordPh):console.log("PH tidak ada pembaharuan data"));const C=parseFloat((e==null?void 0:e.Ph)??"NaN"),I=parseFloat((e==null?void 0:e.Kelembapan)??"NaN"),O=isNaN(C)?"N/A":C.toFixed(1),j=isNaN(I)?"N/A":I.toFixed(1),_=document.getElementById("phValue"),Y=document.getElementById("humidityValue"),z=document.getElementById("ground-good-status"),J=document.getElementById("ground-poor-status");if(!isNaN(C)&&!isNaN(I)&&(C>9.5||C<5||I>90||I<10)?(z.classList.add("hidden"),J.classList.remove("hidden")):(J.classList.add("hidden"),z.classList.remove("hidden")),_&&(_.textContent=O),Y&&(Y.textContent=j),o){if(r&&Array.isArray(r.timestamps)&&Array.isArray(r.values)){const p=r.timestamps.map(Number),U=r.values.map(Number);navigator.onLine?(It(p,U),mt(M)):et(1).then(N=>{N&&N.length>0&&setTimeout(Ct,200)})}if(c&&Array.isArray(c.timestamps)&&Array.isArray(c.values)){const p=c.timestamps.map(Number),U=c.values.map(Number);navigator.onLine?(Et(p,U),gt(P)):tt(1).then(N=>{N&&N.length>0&&setTimeout(xt,200)})}}}catch(s){console.error("‚ùå Error parsing WebSocket message:",s)}},w.onerror=n=>{console.error("‚ö†Ô∏è WebSocket error:",n)},w.onclose=n=>{console.warn(`‚ö†Ô∏è WebSocket disconnected. Code: ${n.code}, Reason: ${n.reason}`),setTimeout(()=>{console.log("üîÅ Mencoba reconnect WebSocket..."),nt()},5e3)}},G="BEr7RhsHyH-U39qwfNHjCgsxD3_cBFL17xttbkvTWYbavxeJoED-IKkSf1Ui4CUYiIdGsNeknYBqeEjVuIFQgFc";function Q(t){const n="=".repeat((4-t.length%4)%4),s=(t+n).replace(/\-/g,"+").replace(/_/g,"/"),a=window.atob(s),e=new Uint8Array(a.length);for(let o=0;o<a.length;++o)e[o]=a.charCodeAt(o);return e}async function X(t,n){if(!n)throw console.error("No auth token found"),new Error("Authentication token is missing.");const s="https://chili-monitor-data.andzuru.space/api/save-subscription";console.log("Preparing subscription data for backend...");const a=t.getKey("p256dh"),e=t.getKey("auth");if(!a||!e)throw console.error("Subscription keys are missing"),new Error("Subscription keys are missing");const o={endpoint:t.endpoint,keys:{p256dh:btoa(String.fromCharCode(...new Uint8Array(a))),auth:btoa(String.fromCharCode(...new Uint8Array(e)))}};console.log("Sending subscription to backend:",o);try{const i=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(o)}),r=await i.json();if(!i.ok)throw console.error("Backend subscription error:",r),new Error(r.message||"Failed to send subscription to backend");return console.log("Backend subscription successful:",r),r}catch(i){throw console.error("Subscription error:",i),i}}async function Z(t,n){if(!n)throw console.error("No auth token found"),new Error("Authentication token is missing.");const s="https://chili-monitor-data.andzuru.space/api/delete-subscription",a={endpoint:t};try{const e=await fetch(s,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(a)}),o=await e.json();if(!e.ok)throw new Error(o.message||"Failed to send unsubscription to backend");return console.log("Unsubscription sent to backend successfully:",o),o}catch(e){throw console.error("Error sending unsubscription to backend:",e),e}}async function W(){if(!("serviceWorker"in navigator)||!("PushManager"in window))return{supported:!1,subscribed:!1,error:"Push notification not supported"};try{const n=await(await navigator.serviceWorker.ready).pushManager.getSubscription();return{supported:!0,subscribed:!!n,subscriptionObject:n}}catch{return{supported:!0,subscribed:!1,error:"Failed to check subscription status."}}}function x(t){const n=document.getElementById("subscribeBtn"),s=document.getElementById("subscribeBtnMobile");n&&s&&(t?(n.textContent="Unsubscribe",n.classList.remove("text-primary","hover:text-tersier"),n.classList.add("bg-primary","px-6","text-white","rounded-full","transition-colors","hover:text-primary","hover:bg-white"),s.textContent="Unsubscribe",s.classList.remove("group-hover:text-tersier"),s.classList.add("bg-primary","px-6","text-white","rounded-full","transition-colors","hover:text-primary","hover:bg-white")):(n.textContent="Subscribe",n.classList.remove("bg-primary","px-6","text-white","rounded-full","hover:bg-white","hover:text-primary"),n.classList.add("text-primary","hover:text-tersier"),s.textContent="Subscribe",s.classList.remove("bg-primary","px-6","text-white","rounded-full","hover:bg-white","hover:text-primary"),s.classList.add("group-hover:text-tersier")))}async function wt(){if(!("serviceWorker"in navigator)||!("PushManager"in window)){console.warn("Push notification tidak didukung.");return}try{const t=await navigator.serviceWorker.register("/sw.js");if(console.log("Service Worker terdaftar:",t),await Notification.requestPermission()==="denied"){console.warn("Izin notifikasi tidak diberikan"),x(!1);return}const s=await W();x(s.subscribed)}catch(t){console.error("Gagal setup push notification:",t)}}function vt(t=8){return Math.random().toString(36).substring(2,2+t)}function h(t,n){const s=document.getElementById("modal-notif-container"),a=document.getElementById("modal-notif-alert"),e=document.getElementById("modal-main-notif"),o=document.getElementById("title-notif-modal"),i=document.getElementById("content-notif-modal"),r=document.getElementById("close-notif");if(!s||!a||!e||!i||!r){console.error("Modal elements not found in the DOM");return}i.textContent=n,o.textContent=t,s.classList.remove("hidden"),a.classList.remove("hidden"),r.onclick=()=>{s.classList.add("hidden"),a.classList.add("hidden")},window.onclick=c=>{!e.contains(c.target)&&c.target===s&&(s.classList.add("hidden"),a.classList.add("hidden"))}}async function st(t=0){if(t>=5)return console.error("Failed to auto-register after multiple attempts due to duplicate username/email."),h("Registration Failed","Failed to auto-register after multiple attempts due to duplicate username/email."),!1;const s=vt(6),a=`user${s}`,e=`user${s}@example.com`,o="password123";try{console.log(`Attempting to register with: Username=${a}, Email=${e}`);const i=await fetch("https://chili-monitor-data.andzuru.space/api/register-auto-login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:a,email:e,password:o})}),r=await i.json();if(i.ok&&r.success)return console.log("Registration successful, token received:",r.token),localStorage.setItem("userToken",r.token),localStorage.setItem("userToken_createdAt",Date.now()),h("Registration Successful","Registration successful! You have automatically logged in."),!0;if(i.status===409)return console.warn("Username or email already exists. Retrying with new random values."),st(t+1);{console.error("Registration failed:",r.message||"Unknown error",r);const c="Registration Failed",d=`Registration failed: ${r.message||"An error occurred during registration."}`;return h(c,d),!1}}catch(i){return console.error("Error during registration:",i),h("Registration Failed","An error occurred during registration."),!1}}function kt(t){if(!t)return!1;try{const n=t.split(".");if(n.length!==3)return!1;const s=JSON.parse(atob(n[1]));if(s.exp){const a=Math.floor(Date.now()/1e3);if(s.exp<a)return console.log("Token expired locally."),!1}return!0}catch(n){return console.error("Error decoding or validating token locally:",n),!1}}document.addEventListener("DOMContentLoaded",async()=>{nt(),yt(),ut().then(()=>{}).catch(c=>console.error("Failed to open IndexedDB:",c));let t=localStorage.getItem("userToken"),n=localStorage.getItem("userToken_createdAt");const s=24*60*60*1e3;if(t&&kt(t)&&Date.now()-n<s)console.log("Valid user token found in localStorage:",t);else if(console.log("No valid user token found or token expired/too old. Attempting to auto-register and login."),localStorage.removeItem("userToken"),localStorage.removeItem("userToken_createdAt"),await st())t=localStorage.getItem("userToken"),console.log("Auto-registration and login successful. New Token:",t);else{console.error("Auto-registration and login failed. User cannot proceed without a token."),h("Registration Failed","Failed to obtain a user session. Certain functions may not work.");return}await wt();const a=document.getElementById("subscribeBtn"),e=document.getElementById("subscribeBtnMobile");a&&a.addEventListener("click",async()=>{const c=localStorage.getItem("userToken");if(!c){h("Subscription Failed","User session not found. Please refresh the page to get a new session.");return}const d=await W();if(d.subscribed)try{await Z(d.subscriptionObject.endpoint,c),await d.subscriptionObject.unsubscribe(),console.log("Successfully unsubscribed!"),x(!1),h("Successfully Unsubscribed","You have successfully unsubscribed from push notifications.")}catch(l){console.error("Error unsubscribing:",l),h("Unsubscription Failed","Failed to unsubscribe. Please try again.")}else try{const l=await navigator.serviceWorker.ready,m=Q(G),g=await l.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:m});await X(g,c),console.log("Successfully subscribed!"),x(!0),h("Successful Subscription","You have successfully subscribed to push notifications!")}catch(l){console.error("Error subscribing:",l),h("Subscription Failed","Failed to subscribe. Please ensure notifications are enabled and try again.")}}),e&&e.addEventListener("click",async()=>{const c=localStorage.getItem("userToken");if(!c){h("Unsubscription Failed","User session not found. Please refresh the page to get a new session.");return}const d=await W();if(d.subscribed)try{await Z(d.subscriptionObject.endpoint,c),await d.subscriptionObject.unsubscribe(),console.log("Successfully unsubscribed (Mobile)!"),x(!1),h("Unsubscription Failed","You have successfully unsubscribed from push notifications.")}catch(l){console.error("Error unsubscribing (Mobile):",l),h("Unsubscription Failed","Failed to unsubscribe. Please try again.")}else try{const l=await navigator.serviceWorker.ready,m=Q(G),g=await l.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:m});await X(g,c),console.log("Successfully subscribed (Mobile)!"),x(!0),h("Successfully subscribed (Mobile)!","You have successfully subscribed to push notifications!")}catch(l){console.error("Error subscribing (Mobile):",l),h("Successfully subscribed (Mobile)!","Failed to subscribe. Please ensure notifications are enabled and try again.")}});const o=localStorage.getItem("lastWelcomeBackShown"),i=6*60*60*1e3,r=Date.now();(!o||r-parseInt(o)>i)&&(h("Welcome Back!","It's good to see you again. ‚ú®üòä"),localStorage.setItem("lastWelcomeBackShown",r))});async function Ct(){const t=await et();if(!t||t.length===0){v.data.datasets[0].data=[],v.data.labels=[],v.update();return}const n=t.slice().reverse(),s=n.map(e=>{const o=new Date(e.phDataReceivedAt),i=o.getFullYear(),r=String(o.getMonth()+1).padStart(2,"0"),c=String(o.getDate()).padStart(2,"0"),d=String(o.getHours()).padStart(2,"0"),l=String(o.getMinutes()).padStart(2,"0"),m=String(o.getSeconds()).padStart(2,"0");return`${i}-${r}-${c} ${d}:${l}:${m}`}),a=n.map(e=>e.phValue);v.data.datasets[0].data=a,v.data.labels=s,v.update()}function It(t,n){function s(e){const o=new Date(e);o.getFullYear(),String(o.getMonth()+1).padStart(2,"0"),String(o.getDate()).padStart(2,"0");const i=String(o.getHours()).padStart(2,"0"),r=String(o.getMinutes()).padStart(2,"0");return String(o.getSeconds()).padStart(2,"0"),`${i}:${r}`}const a=t.map(e=>s(e));v.data.datasets[0].data=n,v.data.labels=a,v.update()}const Dt={labels:[],datasets:[{label:"Soil pH",data:[],borderColor:"rgba(75, 192, 192, 1)",backgroundColor:"rgba(75, 192, 192, 0.2)",borderWidth:2}]},Bt={type:"line",data:Dt,options:{scales:{y:{beginAtZero:!1}}}},v=new Chart(document.getElementById("myChart1"),Bt);async function xt(){const t=await tt();if(!t||t.length===0){k.data.datasets[0].data=[],k.data.labels=[],k.update();return}const n=t.slice().reverse(),s=n.map(e=>{const o=new Date(e.humidityDataReceivedAt),i=o.getFullYear(),r=String(o.getMonth()+1).padStart(2,"0"),c=String(o.getDate()).padStart(2,"0"),d=String(o.getHours()).padStart(2,"0"),l=String(o.getMinutes()).padStart(2,"0"),m=String(o.getSeconds()).padStart(2,"0");return`${i}-${r}-${c} ${d}:${l}:${m}`}),a=n.map(e=>e.humidityValue);k.data.datasets[0].data=a,k.data.labels=s,k.update()}function Et(t,n){function s(e){const o=new Date(e);o.getFullYear(),String(o.getMonth()+1).padStart(2,"0"),String(o.getDate()).padStart(2,"0");const i=String(o.getHours()).padStart(2,"0"),r=String(o.getMinutes()).padStart(2,"0");return String(o.getSeconds()).padStart(2,"0"),`${i}:${r}`}const a=t.map(e=>s(e));console.log(a),k.data.datasets[0].data=n,k.data.labels=a,k.update()}const At={labels:[],datasets:[{label:"Soil Moisture",data:[],borderColor:"rgba(54, 162, 235, 1)",backgroundColor:"rgba(54, 162, 235, 0.2)",borderWidth:2}]},Lt={type:"line",data:At,options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!1}}}},k=new Chart(document.getElementById("myChart"),Lt),H=document.querySelector("#hamburger"),$=document.querySelector("#nav-menu");H.addEventListener("click",function(){H.classList.toggle("hamburger-active"),$.classList.toggle("hidden")});window.addEventListener("click",function(t){t.target!=H&&t.target!=$&&(H.classList.remove("hamburger-active"),$.classList.add("hidden"))});const R=document.getElementById("modal-container-1"),F=document.getElementById("modal-container-2"),L=document.getElementById("modal-confirm-download-container"),T=document.getElementById("modal-confirm-download-alert"),Tt=document.getElementById("modal-main"),Nt=document.getElementById("modal-main-download"),rt=document.getElementById("info-button"),at=document.getElementById("close-modal"),D=document.getElementById("download-data"),V=document.getElementById("cancel-download"),q=document.getElementById("get-ph-data-modal"),K=document.getElementById("get-humidity-data-modal"),E=document.getElementById("content-download-modal"),it=document.getElementById("title-download-modal");let B=null;rt.addEventListener("click",()=>{R.classList.remove("hidden"),F.classList.remove("hidden")});q.addEventListener("click",()=>{L.classList.remove("hidden"),T.classList.remove("hidden"),B="ph",it.textContent="Download PH Data",E.textContent="Do you want to download the pH data?"});K.addEventListener("click",()=>{L.classList.remove("hidden"),T.classList.remove("hidden"),B="humidity",it.textContent="Download Humidity Data",E.textContent="Do you want to download the humidity data?"});D.addEventListener("click",()=>{B==="ph"?(D.disabled=!0,E.textContent="Mengunduh data pH...",setTimeout(async()=>{await pt()},4e3),setTimeout(()=>{D.disabled=!1,E.textContent="Data pH berhasil diunduh."},1500)):B==="humidity"&&(D.disabled=!0,E.textContent="Mengunduh data kelembapan...",setTimeout(async()=>{await ft()},4e3),setTimeout(()=>{D.disabled=!1,E.textContent="Data humidity berhasil diunduh."},1500)),setTimeout(()=>{L.classList.add("hidden"),T.classList.add("hidden"),B=null},5e3)});V.addEventListener("click",()=>{L.classList.add("hidden"),T.classList.add("hidden"),B=null});at.addEventListener("click",()=>{R.classList.add("hidden"),F.classList.add("hidden")});window.addEventListener("click",function(t){!L.classList.contains("hidden")&&!T.classList.contains("hidden")?!Nt.contains(t.target)&&t.target!==D&&t.target!==V&&t.target!==q&&t.target!==K&&(L.classList.add("hidden"),T.classList.add("hidden"),B=null):!R.classList.contains("hidden")&&!F.classList.contains("hidden")&&!Tt.contains(t.target)&&t.target!==D&&t.target!==rt&&t.target!==at&&t.target!==V&&t.target!==q&&t.target!==K&&(R.classList.add("hidden"),F.classList.add("hidden"))});flushButton.addEventListener("click",()=>{nyalakanPompa();const t={action:"pumpIsActive"};w.readyState===WebSocket.OPEN&&w.send(JSON.stringify(t))});function ct(){const t=moment(),n=t.hour(),s=t.minute(),a=t.second(),e=t.format("HH : mm : ss");document.getElementById("clock").textContent=e;let o;n<7||n===7&&s===0&&a===0?o=moment().hour(7).minute(0).second(0):o=moment().add(1,"days").hour(7).minute(0).second(0),n===7&&s===0&&a===0&&nyalakanPompa();const i=moment.duration(o.diff(t)),r=String(i.hours()).padStart(2,"0"),c=String(i.minutes()).padStart(2,"0"),d=String(i.seconds()).padStart(2,"0"),l=`${r}`,m=`${c}`,g=`${d}`;document.getElementById("countdownHour").textContent=l,document.getElementById("countdownMinute").textContent=m,document.getElementById("countdownSecond").textContent=g}setInterval(ct,1e3);ct();
